---
import { allLocales } from '@/config'
import { getLangFromLocale, getLangRouteParam } from '@/i18n/lang'
import { ui } from '@/i18n/ui'
import Layout from '@/layouts/Layout.astro'

export async function getStaticPaths() {
  return allLocales.map(lang => ({
    params: { lang: getLangRouteParam(lang) },
  }))
}

const currentLang = getLangFromLocale(Astro.currentLocale)
const currentUI = ui[currentLang as keyof typeof ui] ?? {}
---

<Layout>
  <!-- Decorative Line -->
  <div class="uno-decorative-line" />
  
  <div class="heti mb-12">
    <h1>{currentUI.search}</h1>
  </div>

  <div class="max-w-[var(--content-width)] mx-auto px-4 sm:px-0">
    <div id="search" class="ml-3 p-4"></div>
  </div>

  <link href="/pagefind/pagefind-ui.css" rel="stylesheet" />
  <script is:inline src="/pagefind/pagefind-ui.js"></script>

  <script is:inline>
    function initPagefind() {
      const searchContainer = document.getElementById('search');
      if (!searchContainer) return;
      
      // Clear previous instance if exists (for View Transitions)
      searchContainer.innerHTML = '';
      
      // Check if PagefindUI is loaded
      if (typeof PagefindUI === 'undefined') return;
      
      new PagefindUI({
        element: '#search',
        showSubResults: true,
        showImages: false,
        translations: {
          placeholder: 'Search...',
          zero_results: 'No results found for "[SEARCH_TERM]"',
        }
      });
    }
    
    // Initialize on first load
    document.addEventListener('DOMContentLoaded', initPagefind);
    
    // Reinitialize on View Transitions navigation
    document.addEventListener('astro:page-load', initPagefind);
  </script>
  
  <style is:global>
    /* Customize Pagefind UI to match theme */
    :root {
      --pagefind-ui-scale: 1;
      --pagefind-ui-primary: var(--c-main);
      --pagefind-ui-text: var(--c-text);
      --pagefind-ui-background: var(--c-bg);
      --pagefind-ui-border: var(--c-border);
      --pagefind-ui-tag: var(--c-main);
      --pagefind-ui-border-width: 1px;
      --pagefind-ui-border-radius: 0.25rem;
      --pagefind-ui-image-border-radius: 0.25rem;
      --pagefind-ui-image-box-ratio: 3 / 2;
      --pagefind-ui-font: inherit;
    }

    .dark {
      --pagefind-ui-primary: var(--c-main);
      --pagefind-ui-text: var(--c-text);
      --pagefind-ui-background: var(--c-bg);
      --pagefind-ui-border: var(--c-border);
      --pagefind-ui-tag: var(--c-main);
    }

    /* Additional tweaks for better integration */
    .pagefind-ui__search-input {
      background-color: transparent;
      color: var(--c-text);
    }
    
    .pagefind-ui__result-title {
      color: var(--c-main) !important;
    }
    
    .pagefind-ui__result-excerpt {
      color: var(--c-text-light) !important;
    }
  </style>
</Layout>
